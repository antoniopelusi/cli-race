#include<stdio.h>
#include<stdlib.h>
#include<time.h>
#include<unistd.h>
#include<termios.h>
#include<fcntl.h>
int d=75000,rw=16,s=0;void sm(int e){struct termios t;tcgetattr(0,&t);t.c_lflag=e?(t.c_lflag|ICANON|ECHO):(t.c_lflag&~(ICANON|ECHO));if(!e)t.c_cc[VMIN]=1,t.c_cc[VTIME]=0;tcsetattr(0,TCSANOW,&t);}int kh(){struct termios t,o;int ch,f;tcgetattr(0,&o);t=o;t.c_lflag&=~(ICANON|ECHO);t.c_cc[VMIN]=1;t.c_cc[VTIME]=0;tcsetattr(0,TCSANOW,&t);f=fcntl(0,F_GETFL,0);fcntl(0,F_SETFL,f|O_NONBLOCK);ch=getchar();tcsetattr(0,TCSANOW,&o);fcntl(0,F_SETFL,f);return(ch!=EOF)?ungetc(ch,stdin),1:0;}void gr(char r[],int p,int*n){static int cur=0;cur+=(rand()%3)-1;if(cur<-1)cur=-1;if(cur>1)cur=1;*n=p+cur;if(*n-rw/2<0)*n=rw/2;if(*n+rw/2>=80)*n=80-rw/2-1;for(int i=0;i<80;i++)r[i]=(i<*n-rw/2||i>*n+rw/2)?'G':(i==*n-rw/2||i==*n+rw/2)?'E':'D';}void pr(char r[],int n){printf("\x1b[%d;1H",n+1);for(int i=0;i<80;i++)printf(r[i]=='G'?"\x1b[42m \x1b[0m":r[i]=='E'?"\x1b[47m \x1b[0m":"\x1b[40m \x1b[0m");}void mv(int*c,char i){if(i=='a'&&*c>1)*c-=2;else if(i=='d'&&*c<79)*c+=2;}int main(){char m[24][80];srand(time(0));sm(0);printf("\x1b[?25l");int p=40,c=40;for(int i=0;i<24;i++)for(int j=0;j<80;j++)m[i][j]=(j<p-rw/2||j>p+rw/2)?'G':(j==p-rw/2||j==p+rw/2)?'E':'D';system("clear");while(1){if(kh()){char in=getchar();if(in==27){system("clear");break;}mv(&c,in);}char nr[80];int n;gr(nr,p,&n);p=n;for(int i=23;i>0;i--)for(int j=0;j<80;j++)m[i][j]=m[i-1][j];for(int j=0;j<80;j++)m[0][j]=nr[j];for(int i=0;i<24;i++)pr(m[i],i);printf("\x1b[1;1HScore:%d\n\x1b[20;%dH\x1b[41m**\x1b[0m",s++,c);if(m[19][c-1]=='G'||m[19][c]=='G'){printf("\nCRASH!\n");break;}fflush(stdout);usleep(d);if(s%100==0&&rw>8)rw--;d-=10;}sm(1);printf("\x1b[?25h");return 0;}